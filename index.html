<html ng-app="myApp">
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.8/angular.min.js"></script>
		<script src="angular-ui-router.js"></script>
		<link rel="stylesheet" href="styles.css">
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
	</head>
	<body>
		<div ui-view="main"></div>
		<script>
			var myApp = angular.module('myApp', ['ui.router']);
			
			myApp.config(function ($stateProvider, $urlRouterProvider, $locationProvider) {

				$locationProvider.html5Mode(true);

				$urlRouterProvider.otherwise('/beer');

				$stateProvider
				.state('main', {
					abstract: true,
					views: {
						'main': {
							templateUrl: 'main.html',
							controller: 'MainCtrl'
						}
					}
				})
				.state('main.beer', {
					url: '/beer',
					views: {
						'content': {
							templateUrl: 'items.html',
							controller: 'BeerCtrl'
						}
					}
				})
				.state('main.wine', {
					url: '/wine',
					views: {
						'content': {
							templateUrl: 'items.html',
							controller: 'WineCtrl'
						}
					}
				})
				.state('main.cart', {
					url: '/cart',
					views: {
						'content': {
							templateUrl: 'cart.html',
							controller: 'CartCtrl'
						}
					}
				});

			});

			myApp.controller('MainCtrl', function ($scope, cartFactory, $timeout) {
				$scope.cart = cartFactory.cart;
				$scope.costOfCart = cartFactory.costOfCart;
				$scope.cartStyle = {};
				$scope.$on('itemAdded',function (event) {
					$scope.cartStyle = {
						color: "red"
					};
					$timeout(function () {
						$scope.cartStyle = {};
					},360);
				})
			})

			myApp.controller('BeerCtrl', function ($scope, cartFactory) {
				$scope.header = 'Beer';
				
				$scope.items = [
					{
						name: 'James Squire One Fifty Lashes Pale Ale',
						price: 5.50
					},
					{
						name: 'Victoria Bitter',
						price: 4.50
					},
					{
						name: 'Fat Yak',
						price: 6.50
					}
				];

				$scope.addToCart = function (item) {
					cartFactory.addToCart(item);
					$scope.$emit('itemAdded');
				}
			});

			myApp.factory('itemFactory', function() {

				var item = {};
				var items = [];

				item.getItems = function () {
					return items;
				}

				return item;


				var d = $q.defer();

				obj.asyncMethod(function () {
					if (taskSucceeds) {
						d.resolve();
					} else {
						d.reject();
					}
				});

				return d.promise;

			});

			myApp.factory('cartFactory', function() {

				var cart = {};

				cart.cart = [];

				cart.addToCart = function (item) {
					cart.cart.push(item);
				}

				cart.removeFromCart = function (index) {
					cart.cart.splice(index,1);
				}

				cart.costOfCart = function () {
					return cart.cart.reduceRight(function (a, b) {return a + b.price;},0);
				}

				return cart;

			});

			myApp.controller('WineCtrl', function ($scope,cartFactory) {
				$scope.header = 'Wine';
				
				$scope.items = [
					{
						name: 'Penfolds Grange',
						price: 11.00
					},
					{
						name: 'Wolf Blass Red Label Moscato',
						price: 7.00
					},
					{
						name: 'Lindemans Bin 25 Brut Cuvee',
						price: 8.00
					}
				];

				$scope.addToCart = cartFactory.addToCart;
			});

			myApp.controller('CartCtrl', function ($scope,cartFactory) {
				$scope.header = 'Cart';

				$scope.removeFromCart = cartFactory.removeFromCart;
			});

		</script>
	</body>
</html>